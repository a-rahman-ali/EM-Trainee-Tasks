<div class="container">
  <div class="books-list mat-elevation-z4">
    <h2 class="text-center ms-5">
        Available Books
    </h2>
    <table mat-table [dataSource]="books" class="mat-elevation-z8">
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let book">{{ book.title }}</td>
      </ng-container>
  
      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef>Author</th>
        <td mat-cell *matCellDef="let book">{{ book.author }}</td>
      </ng-container>
  
      <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef>Edit</th>
        <td class="text-center" mat-cell *matCellDef="let book">
          <button mat-icon-button color="primary" (click)="editBook(book)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="delete">
        <th mat-header-cell *matHeaderCellDef>Delete</th>
        <td mat-cell *matCellDef="let book">
          <button mat-icon-button color="warn" (click)="deleteBook(book.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
  
      <tr mat-header-row *matHeaderRowDef="['title', 'author', 'edit', 'delete']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['title', 'author', 'edit', 'delete'];"></tr>
    </table>
  </div>
  
  <!-- Add/Edit book form -->
  <form [formGroup]="bookForm" (ngSubmit)="isEditMode ? updateBook() : addBook()" class="edit-form">
    <mat-card class="book-card">
      <mat-card-header>
        <mat-card-title>{{ isEditMode ? 'Edit Book' : 'Add Book' }}</mat-card-title>
      </mat-card-header>
      <mat-card-content class="form-content">
        <mat-form-field>
          <input matInput placeholder="Title" formControlName="title" required />
          <mat-error *ngIf="bookForm.get('title')!.hasError('required')">
            This field is required
          </mat-error>
        </mat-form-field>
        <mat-form-field>
          <textarea matInput placeholder="Description" formControlName="description" required></textarea>
          <mat-error *ngIf="bookForm.get('description')!.hasError('required')">
            This field is required
          </mat-error>
        </mat-form-field>
        <mat-form-field>
          <input matInput placeholder="ISBN13" formControlName="isbn13" required />
          <mat-error *ngIf="bookForm.get('isbn13')!.invalid">
            {{ getErrorMessage('isbn13') }}
          </mat-error>
        </mat-form-field>
        <mat-form-field>
          <input matInput type="number" placeholder="Book Count" formControlName="book_count" required 
            [attr.min]="0" [attr.disable]="bookForm.get('book_count')?.value < 0 ? true : null" />
            <mat-error *ngIf="bookForm.get('book_count')!.hasError('required')">
                This field is required
              </mat-error>
              <mat-error *ngIf="bookForm.get('book_count')!.hasError('minValue')">
                Book count must be greater than or equal to 0
            </mat-error>
        </mat-form-field>
        <mat-form-field>
            <input matInput placeholder="Image URL" formControlName="image" required />
            <mat-error *ngIf="bookForm.get('image')!.hasError('required')">
                This field is required
            </mat-error>
            <mat-error *ngIf="bookForm.get('image')!.hasError('pattern')">
                Please enter a valid URL starting with 'https' and ending with '.jpg' or '.png'
            </mat-error>
        </mat-form-field><br>
        <mat-form-field>
            <input matInput placeholder="Author" formControlName="author" required />
            <mat-error *ngIf="bookForm.get('author')!.hasError('required')">
                This field is required
            </mat-error>
            <mat-error *ngIf="bookForm.get('author')!.hasError('invalidAuthor')">
                Author name should not contain numeric values or special symbols (except & and .)
            </mat-error>
        </mat-form-field>
        <mat-form-field>
            <mat-label>Category</mat-label>
            <mat-select formControlName="category" required>
              <mat-option *ngFor="let category of categories" [value]="category">
                {{ category }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="bookForm.get('category')!.hasError('required')">
              Please select a category.
            </mat-error>
        </mat-form-field>
        
      </mat-card-content>
      <mat-card-actions>
        <button mat-raised-button color="primary" type="submit">{{ isEditMode ? 'Update Book Details' : 'Add Book' }}</button>
      </mat-card-actions>
    </mat-card>
  </form>
</div>
